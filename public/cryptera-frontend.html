<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cryptera APK Detector</title>
  <style>
    /* keep the styles inline ‚Äî copy from your previous frontend */
    body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; background:#f9fafb; color:#222; }
    header { text-align:center; padding:2rem; background:#0d47a1; color:#fff; border-bottom-left-radius:20px; border-bottom-right-radius:20px; }
    .upload-box { background:#fff; margin:2rem auto; padding:2rem; width:90%; max-width:500px; border-radius:15px; box-shadow:0 4px 8px rgba(0,0,0,.1); text-align:center; }
    .scan-btn { margin-top:1.5rem; padding:.7rem 1.5rem; background:#0d47a1; color:#fff; border:none; border-radius:10px; cursor:pointer; }
    .results { width:90%; max-width:900px; margin:2rem auto; background:#fff; padding:2rem; border-radius:15px; box-shadow:0 4px 8px rgba(0,0,0,.1); }
    .cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; }
    .card { background:#fafafa; padding:1rem; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.05); }
    .status.suspicious{color:#d32f2f;} .status.safe{color:#2e7d32;}
    .progress-bar{background:#eee;border-radius:10px;height:15px;margin:.5rem 0;overflow:hidden}
    .progress{background:#f44336;height:100%;width:0%}
  </style>
</head>
<body>
  <header><h1>Cryptera APK Detector</h1><p>Detect fake banking apps instantly</p></header>

  <section class="upload-box">
    <label for="apkUpload">üìÇ Upload APK File</label>
    <input id="apkUpload" type="file" accept=".apk" />
    <p class="hint">Supported: .apk (Max 50MB)</p>
    <button class="scan-btn" id="scanBtn">üîç Scan Now</button>
    <p id="uploadMessage" class="hint"></p>
  </section>

  <section class="results">
    <h2>RESULTS</h2>
    <div id="statusEl" class="status suspicious">No scan yet</div>
    <div class="progress-bar"><div id="progressEl" class="progress"></div></div>
    <p id="riskText" class="risk-text">‚Äî</p>

    <div class="cards">
      <div class="card"><h3>Metadata</h3><p><b>Package:</b> <span id="metaPackage">‚Äî</span></p><p><b>Version:</b> <span id="metaVersion">‚Äî</span></p><p><b>Size:</b> <span id="metaSize">‚Äî</span></p></div>
      <div class="card"><h3>Permission Analysis</h3><ul id="permissionsList"><li>‚Äî</li></ul></div>
      <div class="card"><h3>Certificate & Signature</h3><p id="certInfo">‚Äî</p></div>
      <div class="card"><h3>ML Prediction</h3><p><b>Malicious:</b> <span id="mlMalicious">‚Äî</span></p><p><b>Legit:</b> <span id="mlLegit">‚Äî</span></p><p id="mlReasons" style="font-size:.9rem;color:#555;"></p></div>
    </div>
  </section>

  <footer style="text-align:center;padding:1rem;margin-top:2rem;color:#555;">Made at National Cryptera Hackathon 2025 üöÄ | Team Cryptera</footer>

  <script>
    // If you run the backend at localhost:3000 leave BACKEND_URL as below.
    // If you open the HTML with Live Server (127.0.0.1:5500) this will still work because CORS is enabled.
    const BACKEND_URL = 'http://localhost:3000/api/scan';

    const apkInput = document.getElementById('apkUpload');
    const scanBtn = document.getElementById('scanBtn');
    const uploadMessage = document.getElementById('uploadMessage');
    const statusEl = document.getElementById('statusEl');
    const progressEl = document.getElementById('progressEl');
    const riskText = document.getElementById('riskText');
    const metaPackage = document.getElementById('metaPackage');
    const metaVersion = document.getElementById('metaVersion');
    const metaSize = document.getElementById('metaSize');
    const permissionsList = document.getElementById('permissionsList');
    const certInfo = document.getElementById('certInfo');
    const mlMalicious = document.getElementById('mlMalicious');
    const mlLegit = document.getElementById('mlLegit');
    const mlReasons = document.getElementById('mlReasons');

    let selectedFile = null;
    apkInput.addEventListener('change', e => {
      selectedFile = e.target.files[0];
      uploadMessage.textContent = selectedFile ? `Selected: ${selectedFile.name} (${(selectedFile.size/1024/1024).toFixed(2)} MB)` : '';
    });

    scanBtn.addEventListener('click', async () => {
      if (!selectedFile) return alert('Please select an APK first.');
      setLoading(true); resetResults();
      const fd = new FormData(); fd.append('apk', selectedFile);
      try {
        const res = await fetch(BACKEND_URL, { method:'POST', body: fd });
        if (!res.ok) { const err = await res.json().catch(()=>({})); throw new Error(err.error || 'Server error'); }
        const json = await res.json(); renderResults(json);
      } catch (err) {
        alert('Scan failed: ' + err.message);
        statusEl.textContent = 'ERROR'; statusEl.classList.remove('safe'); statusEl.classList.add('suspicious');
        progressEl.style.width = '100%'; riskText.textContent = 'Scan failed';
      } finally { setLoading(false); }
    });

    function setLoading(v) { scanBtn.disabled = v; scanBtn.textContent = v ? 'Scanning...' : 'üîç Scan Now'; }
    function resetResults() {
      statusEl.textContent = 'Scanning...'; statusEl.classList.remove('safe','suspicious'); riskText.textContent = 'Analyzing...';
      progressEl.style.width = '5%'; metaPackage.textContent = '‚Äî'; metaVersion.textContent = '‚Äî'; metaSize.textContent = '‚Äî';
      permissionsList.innerHTML = '<li>‚Äî</li>'; certInfo.textContent = '‚Äî'; mlMalicious.textContent = '‚Äî'; mlLegit.textContent = '‚Äî'; mlReasons.textContent = '';
    }
    function renderResults(json) {
      metaPackage.textContent = json.metadata.packageName || '‚Äî';
      metaVersion.textContent = json.metadata.version || '‚Äî';
      metaSize.textContent = json.metadata.size || '‚Äî';
      permissionsList.innerHTML = '';
      if (json.permissions && json.permissions.length) {
        json.permissions.forEach(p => {
          const li = document.createElement('li');
          const up = p.toUpperCase();
          const isSusp = (json.permissionAnalysis && json.permissionAnalysis.suspicious && json.permissionAnalysis.suspicious.map(s=>s.toUpperCase()).includes(up));
          li.textContent = (isSusp ? '‚ùå ' : '‚úÖ ') + p;
          permissionsList.appendChild(li);
        });
      } else permissionsList.innerHTML = '<li>None</li>';
      certInfo.textContent = (json.certificate && json.certificate.found) ? `Found: ${json.certificate.file} (fingerprint: ${json.certificate.fingerprint})` : 'No signature file';
      mlMalicious.textContent = json.mlPrediction?.malicious || '‚Äî';
      mlLegit.textContent = json.mlPrediction?.legit || '‚Äî';
      const percent = parseInt((json.mlPrediction?.malicious || '0%').replace('%','')) || 0;
      progressEl.style.width = percent + '%'; riskText.textContent = `${percent}% Suspicious`;
      const classification = json.mlPrediction?.classification || (percent >= 50 ? 'suspicious' : 'safe');
      statusEl.textContent = classification === 'suspicious' ? '‚ùå SUSPICIOUS' : '‚úÖ SAFE';
      statusEl.classList.toggle('suspicious', classification === 'suspicious');
      statusEl.classList.toggle('safe', classification !== 'suspicious');
      if (json.mlPrediction?.reasons?.length) mlReasons.textContent = 'Reasons: ' + json.mlPrediction.reasons.join(' ‚Ä¢ ');
      else mlReasons.textContent = '';
    }
  </script>
</body>
</html>